<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
    </head>
    
    <body>
        היכל התהילה<br>
        https://www.fxp.co.il/showthread.php?t=20773730<br>
        https://www.fxp.co.il/newthread.php?do=newthread&f=576<br />
        <br>
        <input id="autoComplete" type="search" dir="ltr" spellcheck=false autocorrect="off" autocomplete="off" autocapitalize="off">
        
        <input placeholder="קישור לאשכול">
        <button>צור נוסח</button>
        <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
        
        <script>
            const nn = document.querySelectorAll('input')
            //todo tests
            async function init() {
                const uu = new URL(nn[1].value)
                const ff = new URLSearchParams(uu.search)
                console.log(uu, ff)
                
                const r = await fetch('https://fxptest.000webhostapp.com/fxpapi/thread.php?t=' + ff.get('t'))
                const t = await r.json();
                const rr = await fetch('https://fxptest.000webhostapp.com/fxpapi/profile.php?username=' + nn[0].value)
                const tt = await rr.json();
                console.log(t, tt);
                //todo template
                
            }
            
            document.querySelector('button')
                .addEventListener('click', init);
            const autoCompleteJS = new autoComplete({
                selector: "#autoComplete",
                placeHolder: "שם משתמש",
                resultsList: {
                    element: (list, data) => {
                        if (!data.results.length) {
                            // Create "No Results" message element
                            const message = document.createElement("div");
                            // Add class to the created element
                            message.setAttribute("class", "no_result");
                            // Add message text content
                            message.innerHTML = `<span>Found No Results for "${data.query}"</span>`;
                            // Append message element to the results list
                            list.prepend(message);
                        }
                        /*                     const a = document.createElement('a');
                                            const img = document.createElement('img')
                                            img.style ='width:25px;height:25px;background-color:rgba(96,125,139,.17);'
                                                                img.src= data.imgsrc;
                                            img.textContent = data.label;  
                                            a.append(img)	
                                                list.prepend(a);
                                             */
                    },
                    noResults: true,
                },
                resultItem: {
                    highlight: true
                },
                events: {
                    input: {
                        selection: (event) => {
                            const selection = event.detail.selection.value;
                            console.log(selection);
                            autoCompleteJS.input.value = selection.usernamenormal;
                        }
                    }
                },
                data: {
                    src: async (query) => {
                        try {
                            // Fetch Data from external Source
                            const source = await fetch(`https://fxptest.000webhostapp.com/fxpapi/user.php?user=${query}`);
                            // Data should be an array of `Objects` or `Strings`
                            const data = await source.json();
                            
                            return data;
                        } catch (error) {
                            return error;
                        }
                    },
                    // Data source 'Object' key to be searched
                    keys: ["usernamenormal"]
                },
                
            });
            
        </script>
        <footer>
            יוצר הכלי המקורי<br>
            https://www.fxp.co.il/member.php?u=749522 <br>
            https://fxp-hall-of-fame.vercel.app/ <br>
            שונה ועודכן על ידי
            https://www.fxp.co.il/member.php?u=1579492
        </footer>
    </body>
    
</html>
